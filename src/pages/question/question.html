<ion-header>
  <ion-navbar>
    <ion-title>
      {{title}}
    </ion-title>
    <ion-buttons end>
      <button ion-button icon-only (click)="dismiss()">
        <ion-icon name="close"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-list>
    <ion-item>
      <ion-label stacked>Question</ion-label>
      <ion-input type="text" placeholder="This is your question" [(ngModel)]="question.question"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label fixed>Category</ion-label>
      <ion-select [(ngModel)]="question.category.name" interface="popover" (ionChange)="categoryChange($event)">
        <ion-option *ngFor="let category of categorys" [value]="category.name">{{category.name}}</ion-option>
        <ion-option value="new">New category</ion-option>
      </ion-select>
    </ion-item>
    <ion-item>
      <ion-label fixed>Type</ion-label>
      <ion-select [(ngModel)]="question.type" interface="popover" (ionChange)="typeChange($event)">
        <ion-option [value]="QuestionType.classic">Classic</ion-option>
        <ion-option [value]="QuestionType.stopwatch">Stopwatch</ion-option>
        <ion-option [value]="QuestionType.rightPicture">Right picture</ion-option>
        <!--<ion-option value="3">Video</ion-option>
        <ion-option value="4">Pictures</ion-option>-->
      </ion-select>
    </ion-item>
    <div *ngIf="question.type === QuestionType.classic || question.type === QuestionType.stopwatch">
    <ion-item *ngFor="let answer of question.answers; let i = index; trackBy:indexTracker">
      <ion-label fixed>Answer {{answerNumber[i]}}</ion-label>
      <ion-input type="text" placeholder="An answer" [(ngModel)]="question.answers[i]"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label fixed>Right answer</ion-label>
      <ion-select [(ngModel)]="question.rightAnswer" interface="popover">
        <ion-option *ngFor="let answer of question.answers; let i = index" [value]="i">{{answer}}</ion-option>
      </ion-select>
    </ion-item>
    </div>
  </ion-list>

  <ion-slides *ngIf="question.type === QuestionType.rightPicture" centeredSlides pager>
    <ion-slide *ngFor="let answer of question.answers; let i = index; trackBy:indexTracker">
      <ion-spinner *ngIf="!pictures[i]" name="dots" color="primary"></ion-spinner>
      <canvas *ngIf="pictures[i]" [style.background-image]="pictures[i]"></canvas>
      <ion-icon *ngIf="i === question.rightAnswer" name="checkmark-circle-outline" color="primary" class="checkmark"></ion-icon>
    </ion-slide>
  </ion-slides>

  <ion-fab #slidesFab *ngIf="question.type === QuestionType.rightPicture" left bottom>
    <button ion-fab mini><ion-icon name="image"></ion-icon></button>
    <ion-fab-list side="right">
      <!-- realIndex: https://github.com/ionic-team/ionic/issues/12297#issuecomment-329772167 -->
      <button ion-fab (click)="openImagePicker(maxPictures, false)" *ngIf="question.answers.length < maxPictures"><ion-icon name="add"></ion-icon></button>
      <button ion-fab (click)="replacePicture(slides.realIndex)" *ngIf="question.answers.length > 0"><ion-icon name="create"></ion-icon></button>
      <button ion-fab (click)="deletePicture(slides.realIndex)" *ngIf="question.answers.length > 0"><ion-icon name="trash"></ion-icon></button>
      <button ion-fab (click)="rightPicture(slides.realIndex)" *ngIf="question.answers.length > 0"><ion-icon name="checkmark"></ion-icon></button>
    </ion-fab-list>
    <input #fileInput type="file" style="display: none" (change)="getBrowserPictures(maxPictures, false)" accept="image/png, image/jpeg" multiple/>
    <input #fileInputReplace type="file" style="display: none" (change)="getBrowserReplacePicture()" accept="image/png, image/jpeg"/>
  </ion-fab>
</ion-content>

<ion-footer>
  <ion-toolbar color="fulldark">
    <ion-buttons left>
      <button ion-button icon-start (click)="openImagePicker(1, true)" *ngIf="question.extras.length === 0"><ion-icon name="film"></ion-icon>Add intro</button>
      <button ion-button icon-start (click)="deleteExtras()" *ngIf="question.extras.length > 0"><ion-icon name="trash"></ion-icon>Delete intro</button>
    </ion-buttons>
    <input #fileInputExtra type="file" style="display: none" (change)="getBrowserExtras()" accept="image/png, image/jpeg, image/gif, video/mp4, video/webm, video/ogg"/>
    <ion-buttons right>
      <button ion-button (click)="save()" [disabled]="!enableSaveButton()">{{saveButtonName}}</button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
